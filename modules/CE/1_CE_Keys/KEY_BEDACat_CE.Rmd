---
title: "Answer Key"
subtitle: "Bivariate EDA Categorical CE"
author: Derek H. Ogle
layout: page
css: "/css/modules.css"
output:
  html_document:
    self_contained: false
---

```{r echo=FALSE, eval=FALSE}
## Renders an appropriate HTML file and moves to CE directory
source("modules/CE/1_CE_Keys/zzz_modHTML_CEKeys.R")
modHTML_CEKeys("KEY_BEDACat_CE")
```

```{r echo=FALSE, results='hide', message=FALSE}
library(NCStats)
source("../../../rhelpers/knitr_setup.R")
library(captioner)
tbls <- captioner(prefix="Table")
tbls(name="BlightRow","Percentages of outcomes within each tree treatment type. Note that A=no action (control), B=removal of the affected branches, C=spraying of foliage with an antibiotic and the removal of affected branches, 1=the tree died in the same year that the disease was noticed, 2=the tree died after 2-4 years, 3=the tree died after 4 years.")
tbls(name="BlightCol","Percentages of tree treatment type within each outcome. Abbreviations are given in Table 1.")
tbls(name="BlightTot","Percentages of each tree treament type and outcome. Abbreviations are given in Table 1.")

tbls(name="LightRaw","Frequency table for children by lighting conditions during sleep and whether they developed nearsightedness or not.")
tbls(name="LightRow","Percentages of chidren by nearsightedness type within each sleeping condition.")
tbls(name="LightCol","Percentage of children by sleeping conditions within each nearsightedness type.")
tbls(name="LightTot","Percentages of all students in each sleeping condition and nearsightedness type.")

tbls(name="TreesRaw",'Raw frequency table for stands by type ("sttype": c="coniferous",mc="mostly coniferous",md="mostly deciduous", and d="deciduous" and years since last fire category (tslf).')
tbls(name="TreesRow",'Row percentages table for stands by type. Abbreviations are in Table 9.')
tbls(name="TreesCol",'Column percentages table for stands by type. Abbreviations are in Table 9.')
tbls(name="TreesTot",'Total percentages table for stands by type. Abbreviations are in Table 9.')

tbls(name="KidsRaw",'Raw frequency table for grade school students by goals and grade.')
tbls(name="KidsRow",'Row percentages table for grade school students by goals and grade.')
tbls(name="KidsCol",'Column percentages table for grade school students by goals and grade.')
tbls(name="KidsTot",'Total percentages table for grade school students by goals and grade.')
```

----

## Hand Calculations

<ol>
<li>Two-way frequency table is below.</li>
```{r echo=FALSE}
d <- data.frame(VAR1 <- c("C","C","A","C","A","B","C","A","A","B",
                          "A","B","B","A","C","C","A","C","A","B",
                          "B","A","A","C","A","C","B","B"),
                VAR2 <- c("x","x","y","x","x","y","x","y","y","y",
                          "x","x","y","y","y","x","x","x","y","y",
                          "x","y","x","y","x","y","x","y"))
```
```{r eval=FALSE, echo=FALSE}
d <- read.csv("BivEDA_CE1.csv")
```
```{r echo=FALSE}
( tbl <- xtabs(~VAR2+VAR1,data=d))
```

<li>Row Percentages Table</li>
```{r echo=FALSE}
percTable(tbl,margin=1,digits=1)
```

<li>Column Percentages Table</li>
```{r echo=FALSE}
percTable(tbl,margin=2,digits=1)
```

<li>Total Percentages Table</li>
```{r echo=FALSE}
percTable(tbl,digits=1)
```
</ol>

----

<div class="alert alert-warning">
<strong>Note:</strong> 
<ul>
<li>In the remaining questions, the "trick" to making the computation is to determine if the question is restricted to only a portion of the data. If the question is restricted to one of the levels that corresponds to a row then compute a row percentage (i.e., divide the raw frequency by the total of its row).  If the question is restricted to one of the levels that corresponds to a column then compute a column percentage (i.e., divide the raw frequency by the total of its column). If the question does not restrict to a level in either a row or column, then compute a table or total percentage (i.e., divide the raw frequency by the total number of individuals in the table.</li>
</ul>
</div>

## Fire Blight Disease
```{r echo=FALSE}
d <- data.frame(treat=c("A","A","A","A","A","B","B","B","C","C","A","A",
                        "B","B","B","C","C","C","C","B","B","C","C","C"),
                out=factor(c(1,1,1,1,1,1,1,1,1,1,2,2,
                             2,2,2,2,2,2,2,3,3,3,3,3)))
```
```{r BlightTables, echo=FALSE, results='hide'}
( tbl <- xtabs(~treat+out,data=d) )
( row.tbl <- percTable(tbl,margin=1) )
( col.tbl <- percTable(tbl,margin=2) )
( perc.tbl <- percTable(tbl) )
```

<ol>
  <li>The response variable is the outcome (i.e., time of death of the tree). Note that the row percentage table is in `r tbls("BlightRow",display="cite")`, the  column percentage table is in `r tbls("BlightCol",display="cite")`, and the table percentage table is shown in `r tbls("BlightTot",display="cite")`.</li>
  
`r tbls("BlightRow")`

```{r echo=FALSE, background="white"}
row.tbl
```

`r tbls("BlightCol")`

```{r echo=FALSE, background="white"}
col.tbl
```

`r tbls("BlightTot")`

```{r echo=FALSE, background="white"}
perc.tbl
```

  <li>The percentage of all trees in Treatment A that were dead within the first year (i.e., outcome=1) is `r formatC(row.tbl["A","1"],format="f",digits=1)`% (`r tbls("BlightRow",display="cite")`).</li>
  <li>The percentage of ALL trees that were in Treatment A AND were dead within the first year (i.e., outcome=1) is `r formatC(perc.tbl["A","1"],format="f",digits=1)`% (`r tbls("BlightTot",display="cite")`).</li>
  <li>The percentage of the trees in the control treatment (treatment A) that died after four years (i.e., outcome=3) is `r formatC(row.tbl["A","3"],format="f",digits=1)`% (`r tbls("BlightRow",display="cite")`).</li>
  <li>The percentage of the trees that died after 2-4 years (outcome 2) that were in the control treatment (treatment A) is `r formatC(col.tbl["A","2"],format="f",digits=1)`% (`r tbls("BlightCol",display="cite")`).</li>
  <li>The percentage of all trees that were dead within the first year is `r formatC(perc.tbl["Sum","1"],format="f",digits=1)`% (`r tbls("BlightTot",display="cite")`).</li>
</ol>

R Appendix
```{r eval=FALSE, prompt=FALSE}
setwd('C:/aaaWork/Books/IntroStats/HW/')
d <- read.csv("FireBlight.csv")
<<BlightTables>>
```

----

## Lights and Nearsightedness
```{r echo=FALSE}
d <- read.csv("https://raw.githubusercontent.com/droglenc/NCData/master/nightlight.csv")
```
```{r LightTables, echo=FALSE, results='hide'}
( tbl <- xtabs(~Light+Nearsightedness,data=d) )
addmargins(tbl)
( row.tbl <- percTable(tbl,margin=1) )
( col.tbl <- percTable(tbl,margin=2) )
( perc.tbl <- percTable(tbl) )
```

<ol>
  <li>A total of `r tbl["no light","Yes"]` children slept in "no light" conditions and developed nearsightedness `r tbls("LightRaw",display="cite")`.</li>

`r tbls("LightRaw")`

```{r echo=FALSE, background="white"}
addmargins(tbl)
```

  <li>The percentage of children that slept in "no light" conditions that then developed nearsightedness is `r formatC(row.tbl["no light","Yes"],format="f",digits=1)`% (`r tbls("LightRow",display="cite")`).</li>

`r tbls("LightRow")`

```{r echo=FALSE, background="white"}
row.tbl
```

  <li>The percentage of all children that slept with a "lamp" and developed nearsightedness is `r formatC(perc.tbl["lamp","Yes"],format="f",digits=1)`% (`r tbls("LightTot",display="cite")`).</li>

`r tbls("LightTot")`

```{r echo=FALSE, background="white"}
perc.tbl
```

  <li>The percentage of children that slept with a "night light" that did not develop nearsightedness is `r formatC(row.tbl["night light","No"],format="f",digits=1)`% (`r tbls("LightRow",display="cite")`).</li>
  <li>The percentage of children that developed nearsightedness that slept with a "lamp" is `r formatC(col.tbl["lamp","Yes"],format="f",digits=1)`% (`r tbls("LightCol",display="cite")`).</li>

`r tbls("LightCol")`

```{r echo=FALSE, background="white"}
col.tbl
```

  <li>The percentage of children that developed nearsightedness is `r formatC(perc.tbl["Sum","Yes"],format="f",digits=1)`% (`r tbls("LightTot",display="cite")`).</li>
  <li>It appears that the percentage of children that developed nearsightedness is greater when the child slept with some sort of light (either a lamp or a night light), with a somewhat greater prevalence of nearsightedness with the lamp (`r tbls("LightRow",display="cite")`).</li>
</ol>

R Appendix
```{r eval=FALSE, prompt=FALSE}
setwd('C:/aaaWork/Books/IntroStats/HW/')
d <- read.csv("nightlight.csv")
<<LightTables>>
```

----

## Forest Composition

```{r echo=FALSE}
d <- read.csv("https://github.com/droglenc/NCData/raw/master/Fire.csv")
d$sttype <- factor(d$sttype,levels=c("c","mc","md","d"))
tbl <- xtabs(~tslf+sttype,data=d)
row <- percTable(tbl,margin=1)
col <- percTable(tbl,margin=2)
tot <- percTable(tbl)
```

1. There were `r sum(tbl["200-300",])` stands that last had a fire between 200 and 300 years ago (`r tbls("TreesRaw",display="cite")`).
1. The percentage of deciduous tree stands with a fire in the last 100 years is `r formatC(col["0-100","d"],format="f",digits=1)`% (`r tbls("TreesCol",display="cite")`).
1. The percentage of mixed-coniferous tree stands with a fire between 200 and 300 years ago is `r formatC(col["200-300","mc"],format="f",digits=1)`% (`r tbls("TreesCol",display="cite")`).
1. The percentage of all stands that were coniferous with a fire between 200 and 300 years ago is `r formatC(tot["200-300","c"],format="f",digits=1)`% (`r tbls("TreesTot",display="cite")`).
1. The percentage of tree stands that had a fire between 200 and 300 years ago that were coniferous is `r formatC(row["200-300","c"],format="f",digits=1)`% (`r tbls("TreesRow",display="cite")`).
1. The percentage of all stands that were deciduous with a fire between 100 and 200 years ago is `r formatC(tot["100-200","d"],format="f",digits=1)`% (`r tbls("TreesTot",display="cite")`).
1. The percentage of mixed-deciduous stands that had a fire within the last 100 years is `r formatC(col["0-100","md"],format="f",digits=1)`% (`r tbls("TreesCol",display="cite")`).
1. Those with more recent fires tended to be deciduous, those without recent fires tended to be coniferous.

`r tbls("TreesRaw")`

```{r treesRaw, echo=FALSE}
d$sttype <- factor(d$sttype,levels=c("c","mc","md","d"))
( tbl <- xtabs(~tslf+sttype,data=d) )
```

`r tbls("TreesRow")`

```{r treesRow, echo=FALSE}
percTable(tbl,margin=1,digits=1)
```

`r tbls("TreesCol")`

```{r treesCol, echo=FALSE}
percTable(tbl,margin=2,digits=1)
```

`r tbls("TreesTot")`

```{r treesTot, echo=FALSE}
percTable(tbl,digits=1)
```

R Appendix:
```{r eval=FALSE, prompt=FALSE}
d <- read.csv("Fire.csv")
<<treesRaw>>
<<treesRow>>
<<treesCol>>
<<treesTot>>
```

----

## Popularity in Middle School

The questions below use the following tables.

```{r echo=FALSE}
d <- read.csv("https://github.com/droglenc/NCData/raw/master/PopularKids.csv")
tbl <- xtabs(~grade+goals,data=d)
row <- percTable(tbl,margin=1,digits=1)
col <- percTable(tbl,margin=2,digits=1)
tot <- percTable(tbl,digits=1)
```

1. There were `r sum(tbl["4",])` students from the fourth grade in the sample.
1. The percentage of All students in the fifth grade with the goal "to be popular' was `r formatC(tot["5","Popular"],format="f",digits=1)`% (`r tbls("KidsTot",display="cite")`).
1. The percentage of fourth grade students with the goal "to be good in sports" was `r formatC(row["4","Sports"],format="f",digits=1)`% (`r tbls("KidsRow",display="cite")`).
1. The percentage of fifth grade students with the goal "to make good grades" was `r formatC(row["5","Grades"],format="f",digits=1)`% (`r tbls("KidsRow",display="cite")`).
1. The percentage of all students with the goal to "make good grades" was `r formatC(tot["Sum","Grades"],format="f",digits=1)`% (`r tbls("KidsTot",display="cite")`).
1. The percentage of students with the goal "to be popular" that were in the sixth grade was `r formatC(col["6","Popular"],format="f",digits=1)`% (`r tbls("KidsCol",display="cite")`).
1. Fairly even distribution of students into the goals categories among the grades.  Thus, there is no real difference in goals by grade in school.

`r tbls("KidsRaw")`

```{r kidsRaw, echo=FALSE}
( tbl <- xtabs(~grade+goals,data=d) )
```

`r tbls("KidsRow")`

```{r kidsRow, echo=FALSE}
percTable(tbl,margin=1,digits=1)
```

`r tbls("KidsCol")`

```{r kidsCol, echo=FALSE}
percTable(tbl,margin=2,digits=1)
```

`r tbls("KidsTot")`

```{r kidsTot, echo=FALSE}
percTable(tbl,digits=1)
```

R Appendix.
```{r eval=FALSE, prompt=FALSE}
d <- read.csv("PopularKids.csv")
<<kidsRaw>>
<<kidsRow>>
<<kidsCol>>
<<kidsTot>>
```
