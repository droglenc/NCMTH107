---
title: "Answer Key"
subtitle: "Chi-Square CE"
author: Derek H. Ogle
layout: page
css: "/css/modules.css"
output:
  html_document:
    fig_height: 3.5
    fig_width: 3.5
    self_contained: false
---

```{r echo=FALSE, eval=FALSE}
## Renders an appropriate HTML file and moves to CE directory
source("modules/CE/1_CE_Keys/zzz_modHTML_CEKeys.R")
modHTML_CEKeys("KEY_ChiSquare_CE")
```

```{r echo=FALSE, results='hide', message=FALSE, warning=FALSE}
library(NCStats)
source("../../../rhelpers/knitr_setup.R")
library(captioner)
tbls <- captioner(prefix="Table")

tbls(name="PopExpTable","Expected frequency of students (assuming that Ho is true) by stated goal for three grades.")
tbls(name="PopObsTable","Observed frequency of students by stated goal for three grades.")
tbls(name="PopResults","Chi-square test results for testing that the distribution of students by goals differs among grades.")
tbls(name="PopPercTable","Row percentage table for goals by grade of the student.")

tbls(name="ForestExpTable","Expected frequency of stands (assuming that Ho is true) by time since last fire in each of the four stand types.")
tbls(name="ForestObsTable","Observed frequency of stands by time since last fire in each of the four stand types.")
tbls(name="ForestResults","Chi-square test results for testing that the distribution of stands by time since last fire differs among stand types.")
tbls(name="ForestPercTable","Row percentage table for time since last fire by stand type.")

tbls(name="aids1","Expected frequency table for distribution of individuals into race and sex categories.")
tbls(name="aids2","Observed frequency table for distribution of individuals into race and sex categories.")
tbls(name="aids3","Results from the chi-square test for examining the distribution of races by male and female.")
tbls(name="aids4","Row percentage table for the observations of race by sex categories.")
```

----

<div class="alert alert-warning">
<strong>Note:</strong> 
<ul>
<li>Make sure to describe your evidence in Step 3 for why you are performing a chi-square test. It is not adequate to simply say "because there is a categorical response variable and two or more groups are being tests." At least say what the response variable is and what the groups are.</li>
<li>When testing the assumptions (Step 5), make sure to explicitly say that there are more than five in each cell of the expected table. It is not adequate to simply make the expected table.</li>
<li>In hand-calculation questions (e.g., AIDS cases) make sure to put `lower.tail=FALSE` in `distrib()` when calculating the p-value (Step 8) in a chi-square problem. This is true for EVERY chi-square problem.</li>
</ul>
</div>

----

## AIDS Cases
```{r AIDSCalc, echo=FALSE, results='hide'}
obs <- matrix(c(12855,14946,7019,439,1924,6784,1948,103),nrow=2,byrow=TRUE)
rownames(obs) <- c("Male","Female")
colnames(obs) <- c("White","Black","Hispanic","Other")
( aids.chi <- chisq.test(obs,correct=FALSE) )
```

<ol>
  <li>&alpha;=0.01.</li>
  <li>H<sub>O</sub>: "The distribution of people in the race categories is the same for males and females" versus H<sub>A</sub>: "The distribution of people in the race categories is NOT the same for males and females."</li>
  <li>A chi-square test is required because a categorical response variable with four levels (race/ethnicity) from two groups or populations (sex) was recorded.</li>
  <li>This is an observational study without obvious randomization.</li>
  <li>The test statistic computed below should reasonably follow a chi-square distribution because all cells in the expected table (`r tbls("aids1",display="cite")`) have values greater than five.</li>

`r tbls("aids1")`

```{r AIDSExpTable,echo=FALSE,background="white"}
round(aids.chi$expected,1)
```

  <li>The table of observed frequencies were given as in `r tbls("aids2",display="cite")`.</li>

`r tbls("aids2")`

```{r echo=FALSE,background="white"}
aids.chi$observed
```

  <li>The &chi;<sup>2</sup> test statistic is `r formatC(aids.chi$statistic,format="f",digits=1)` with `r formatC(aids.chi$parameter,format="f",digits=0)` df (`r tbls("aids3",display="cite")`).</li>
  
`r tbls("aids3")`

```{r echo=FALSE,background="white"}
kHtest(aids.chi)
```

  <li>The p-value is `r kPvalue(aids.chi$p.value,include.p=FALSE,latex=FALSE)`.</li>
  <li>The H<sub>O</sub> is rejected because the p-value<&alpha;.</li>
  <li>It appears that the distribution of the individuals into the races/ethnicities differs between the sexes. An analysis of the row percentages table (`r tbls("aids4",display="cite")`) shows that there are many more white males and black females than would be expected.</li>

`r tbls("aids4")`

```{r AIDSResids,echo=FALSE,background="white"}
percTable(obs,margin=1,digits=1)
```

</ol>

R Appendix.
```{r eval=FALSE,prompt=FALSE}
library(NCStats)
<<AIDSCalc>>
<<AIDSExpTable>>
<<AIDSResids>>
```

----

## Popularity in Middle School

```{r PopCalc, echo=FALSE, results='hide', fig.show='hide', warning=FALSE}
d <- read.csv("https://github.com/droglenc/NCData/raw/master/PopularKids.csv")
obs <- xtabs(~grade+goals,data=d)
chi1 <- chisq.test(obs,correct=FALSE)
chi1$expected
chi1
percTable(obs,margin=1,digits=1)
```

<ol>
<li>&alpha;=0.05.</li>
<li>H<sub>A</sub>: "The distribution of students into the goals categories differs among grades" and H<sub>O</sub>: "The distribution of students into the goals categories DOES NOT differ among grades".</li>
<li>Chi-square test because (i) the response variable (goals category) is categorial and (ii) two or more groups or populations (grades) were sampled.</li>
<li>This is an observational study because the students were not allocated to grades. The students were not obviously randomly selected (and were likely part of a voluntary response survey).</li>
<li>All cells in the expected frequency table (`r tbls("PopExpTable",display="cite")`) were greater than 5; the assumptions for a chi-square test have been met.</li>

`r tbls("PopExpTable")`

```{r echo=FALSE}
chi1$expected
```

<li>The observed frequency table is shown in `r tbls("PopObsTable",display="cite")`.</li>

`r tbls("PopObsTable")`

```{r echo=FALSE}
chi1$observed
```

<li>&chi;<sup>2</sup>=`r formatC(chi1$statistic,format="f",digits=4)` with `r chi1$parameter` df (`r tbls("PopResults",display="cite")`).</li>

`r tbls("PopResults")`

```{r echo=FALSE}
chi1
```

<li>p-value=`r kPvalue(chi1$p.value,include.p=FALSE,latex=FALSE)` (`r tbls("PopResults",display="cite")`).</li>
<li>Do not reject H<sub>0</sub> because the p-value&gt;&alpha;.</li>
<li>It appears that the distributions of goals by students does not differ by grade. Analysis of the row percentage table (`r tbls("PopPercTable",display="cite")`) suggests that grades are the primary goal for each grade.</li>

`r tbls("PopPercTable")`

```{r echo=FALSE}
percTable(obs,margin=1,digits=1)
```

<li>Not necessary with a chi-square test.</li>
</ol>

R Appendix.
```{r eval=FALSE, prompt=FALSE}
<<PopCalc>>
```

----

## Forest Composition

```{r ForestCalc, echo=FALSE, results='hide', fig.show='hide', warning=FALSE}
d <- read.csv("https://raw.githubusercontent.com/droglenc/NCData/master/Fire.csv")
d$sttype <- factor(d$sttype,levels=c("c","mc","md","d"))
obs <- xtabs(~sttype+tslf,data=d)
chi1 <- chisq.test(obs,correct=FALSE)
chi1$expected
chi1
percTable(obs,margin=1,digits=1)
```

<ol>
<li>&alpha;=0.05.</li>
<li>H<sub>A</sub>: "The distribution of stands into the times since last fire differs among stand types" and H<sub>O</sub>: "The distribution of stands into the times since last fire DOES NOT differ among stand types".</li>
<li>Chi-square test because (i) the response variable (time since last fire) is categorial (in the way it was recorded) and (ii) two or more groups or populations (stand types) were sampled.</li>
<li>This is an observational study because the stand type was not set or manipulated by the researcher. The stands were not obviously randomly selected.</li>
<li>All cells in the expected frequency table (`r tbls("ForestExpTable",display="cite")`) were NOT greater than 5. The p-value calculation below is suspect.</li>

`r tbls("ForestExpTable")`

```{r echo=FALSE}
chi1$expected
```

<li>The observed frequency table is shown in `r tbls("ForestObsTable",display="cite")`.</li>

`r tbls("ForestObsTable")`

```{r echo=FALSE}
chi1$observed
```

<li>&chi;<sup>2</sup>=`r formatC(chi1$statistic,format="f",digits=4)` with `r chi1$parameter` df (`r tbls("ForestResults",display="cite")`).</li>

`r tbls("ForestResults")`

```{r echo=FALSE}
chi1
```

<li>p-value=`r kPvalue(chi1$p.value,include.p=FALSE,latex=FALSE)` (`r tbls("ForestResults",display="cite")`).</li>
<li>Reject H<sub>0</sub> because the p-value&lt;&alpha;.</li>
<li>It appears that the distribution of stands into the times since last fire differs among at least one pair of the stand types. Analysis of the row percentage table (`r tbls("ForestPercTable",display="cite")`) suggests the time since last fire increases as one moves from primarily deciduous to primarily coniferous stands.</li>

`r tbls("ForestPercTable")`

```{r echo=FALSE}
percTable(obs,margin=1,digits=1)
```

<li>Not necessary with a chi-square test.</li>
</ol>

R Appendix.
```{r eval=FALSE, prompt=FALSE}
<<ForestCalc>>
```

----
