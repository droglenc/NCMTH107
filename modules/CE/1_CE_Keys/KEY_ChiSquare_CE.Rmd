---
title: "Answer Key"
subtitle: "Chi-Square CE"
author: Derek H. Ogle
layout: page
css: "/css/modules.css"
output:
  html_document:
    fig_height: 3.5
    fig_width: 3.5
    self_contained: false
---

```{r echo=FALSE, eval=FALSE}
## Renders an appropriate HTML file and moves to CE directory
source("modules/CE/1_CE_Keys/zzz_modHTML_CEKeys.R")
modHTML_CEKeys("KEY_ChiSquare_CE")
```

```{r echo=FALSE, results='hide', message=FALSE, warning=FALSE}
library(NCStats)
source("../../../rhelpers/knitr_setup.R")
library(captioner)
tbls <- captioner(prefix="Table")

tbls(name="hurr1","Expected frequency table for distribution of hurricanes into the strength and time period categories.")
tbls(name="hurr2","Observed frequency table for distribution of hurricanes into the strength and time period categories.")
tbls(name="hurr4","Row percentage table for the observations of hurricane strengths by time period.")

tbls(name="PopExpTable","Expected frequency of students (assuming that Ho is true) by stated goal for three grades.")
tbls(name="PopObsTable","Observed frequency of students by stated goal for three grades.")
tbls(name="PopResults","Chi-square test results for testing that the distribution of students by goals differs among grades.")
tbls(name="PopPercTable","Row percentage table for goals by grade of the student.")

tbls(name="EdmExpTable","Expected frequency of respondents (assuming that Ho is true) by level of agreement for the two parties.")
tbls(name="EdmObsTable","Observed frequency of respondents by level of agreement for the two parties.")
tbls(name="EdmResults","Chi-square test results for testing that the distribution of respondents by level of agreement for the two parties.")
tbls(name="EdmPercTable","Row percentage table for level of agreement by party of the respondents.")

tbls(name="aids1","Expected frequency table for distribution of individuals into race and sex categories.")
tbls(name="aids2","Observed frequency table for distribution of individuals into race and sex categories.")
tbls(name="aids4","Row percentage table for the observations of race by sex categories.")

tbls(name="ForestExpTable","Expected frequency of stands (assuming that Ho is true) by time since last fire in each of the four stand types.")
tbls(name="ForestObsTable","Observed frequency of stands by time since last fire in each of the four stand types.")
tbls(name="ForestResults","Chi-square test results for testing that the distribution of stands by time since last fire differs among stand types.")
tbls(name="ForestPercTable","Row percentage table for time since last fire by stand type.")
```

----

<div class="alert alert-warning">
<strong>Note:</strong> 
<ul>
<li>Make sure to describe your evidence in Step 3 for why you are performing a chi-square test. It is not adequate to simply say "because there is a categorical response variable and two or more groups are being tests." At least say what the response variable is and what the groups are.</li>
<li>When testing the assumptions (Step 5), make sure to explicitly say that there are more than five in each cell of the expected table. It is not adequate to simply make the expected table.</li>
<li>In hand-calculation questions (e.g., hurricanes) make sure to put `lower.tail=FALSE` in `distrib()` when calculating the p-value (Step 8) in a chi-square problem. This is true for EVERY chi-square problem.</li>
<li>You values may differ slightly from mine as I calculate everything in R that holds many decimal places on intermediate values.</li>
</ul>
</div>

----

## Hurricane Strengths
```{r HurrCalc, echo=FALSE, results='hide'}
obs <- matrix(c(51,26,8,44,21,7),nrow=2,byrow=TRUE)
rownames(obs) <- c("1901-1950","1951-2000")
colnames(obs) <- c("Cat 1&2","Cat 3","Cat 4&5")
( hurr.chi <- chisq.test(obs,correct=FALSE) )
```

<ol>
  <li>&alpha;=0.10.</li>
  <li>H<sub>0</sub>: "The distribution of hurricantes into the strength categories is the same for both time periods" versus H<sub>A</sub>: "The distribution of hurricantes into the strength categories is NOT the same for both time periods"</li>
  <li>A chi-square test is required because a categorical response variable with three levels (strength category) from two groups or populations (time periods) was recorded.</li>
  <li>This is an observational study without obvious randomization.</li>
  <li>The test statistic computed below should reasonably follow a chi-square distribution because all cells in the expected table (`r tbls("hurr1",display="cite")`) have values greater than five.</li>

`r tbls("hurr1")`

```{r HurrExpTable,echo=FALSE,background="white"}
round(hurr.chi$expected,1)
```

  <li>The table of observed frequencies were given as in `r tbls("hurr2",display="cite")`.</li>

`r tbls("hurr2")`

```{r echo=FALSE,background="white"}
hurr.chi$observed
```

  <li>The &chi;<sup>2</sup> test statistic is `r formatC(hurr.chi$statistic,format="f",digits=4)` with `r formatC(hurr.chi$parameter,format="f",digits=0)` df (`r tbls("hurr3",display="cite")`).</li>
  <li>The p-value is `r kPvalue(hurr.chi$p.value,include.p=FALSE,latex=FALSE)`.</li>
  <li>The H<sub>0</sub> is rejected because the p-value<&alpha;.</li>
  <li>It appears that the distribution of hurricanes into the strength categories is the same for both time periods (`r tbls("hurr4",display="cite")`).</li>

`r tbls("hurr4")`

```{r HurrResids,echo=FALSE,background="white"}
percTable(obs,margin=1,digits=1)
```

</ol>

R Appendix.
```{r eval=FALSE,prompt=FALSE}
library(NCStats)
distrib(0.0382,distrib="chisq",df=2,lower.tail=FALSE)
```

----

## Popularity in Middle School

```{r PopCalc, echo=FALSE, results='hide', fig.show='hide', warning=FALSE}
d <- read.csv("https://github.com/droglenc/NCData/raw/master/PopularKids.csv")
obs <- xtabs(~grade+goals,data=d)
chi1 <- chisq.test(obs,correct=FALSE)
chi1$expected
chi1
percTable(obs,margin=1,digits=1)
```

<ol>
<li>&alpha;=0.05.</li>
<li>H<sub>A</sub>: "The distribution of students into the goals categories differs among grades" and H<sub>0</sub>: "The distribution of students into the goals categories DOES NOT differ among grades".</li>
<li>Chi-square test because (i) the response variable (goals category) is categorial and (ii) two or more groups or populations (grades) were sampled.</li>
<li>This is an observational study because the students were not allocated to grades. The students were not obviously randomly selected (and were likely part of a voluntary response survey).</li>
<li>All cells in the expected frequency table (`r tbls("PopExpTable",display="cite")`) were greater than 5; the assumptions for a chi-square test have been met.</li>

`r tbls("PopExpTable")`

```{r echo=FALSE}
chi1$expected
```

<li>The observed frequency table is shown in `r tbls("PopObsTable",display="cite")`.</li>

`r tbls("PopObsTable")`

```{r echo=FALSE}
chi1$observed
```

<li>&chi;<sup>2</sup>=`r formatC(chi1$statistic,format="f",digits=4)` with `r chi1$parameter` df (`r tbls("PopResults",display="cite")`).</li>

`r tbls("PopResults")`

```{r echo=FALSE}
chi1
```

<li>p-value=`r kPvalue(chi1$p.value,include.p=FALSE,latex=FALSE)` (`r tbls("PopResults",display="cite")`).</li>
<li>Do not reject H<sub>0</sub> because the p-value&gt;&alpha;.</li>
<li>It appears that the distributions of goals by students does not differ by grade. Analysis of the row percentage table (`r tbls("PopPercTable",display="cite")`) suggests that grades are the primary goal for each grade.</li>

`r tbls("PopPercTable")`

```{r echo=FALSE}
percTable(obs,margin=1,digits=1)
```

<li>Not necessary with a chi-square test.</li>
</ol>

R Appendix.
```{r eval=FALSE, prompt=FALSE}
<<PopCalc>>
```

----

## Political Opinion

```{r EdmCalc, echo=FALSE, results='hide', fig.show='hide', warning=FALSE}
d <- read.csv("https://github.com/droglenc/NCData/raw/master/EdmontonPoll.csv")
obs <- xtabs(~party+agreement,data=d)
chi1 <- chisq.test(obs,correct=FALSE)
chi1$expected
chi1
percTable(obs,margin=1,digits=1)
```

<ol>
<li>&alpha;=0.01.</li>
<li>H<sub>A</sub>: "The distribution of respondents into the levels of agreements differs between political party affiliations" and H<sub>0</sub>: "The distribution of respondents into the levels of agreements does not differ between political party affiliations".</li>
<li>Chi-square test because (i) the response variable (levels of agreement) is categorial and (ii) two or more groups or populations (political party affiliation) were sampled.</li>
<li>This is an observational study because the respondents were not allocated to political party affiliations. The respondents were not obviously randomly selected (and were likely part of a voluntary response survey).</li>
<li>All cells in the expected frequency table (`r tbls("EdmExpTable",display="cite")`) were greater than 5; the assumptions for a chi-square test have been met.</li>

`r tbls("EdmExpTable")`

```{r echo=FALSE}
chi1$expected
```

<li>The observed frequency table is shown in `r tbls("EdmObsTable",display="cite")`.</li>

`r tbls("EdmObsTable")`

```{r echo=FALSE}
chi1$observed
```

<li>&chi;<sup>2</sup>=`r formatC(chi1$statistic,format="f",digits=4)` with `r chi1$parameter` df (`r tbls("EdmResults",display="cite")`).</li>

`r tbls("EdmResults")`

```{r echo=FALSE}
chi1
```

<li>p-value=`r kPvalue(chi1$p.value,include.p=FALSE,latex=FALSE)` (`r tbls("EdmResults",display="cite")`).</li>
<li>Do not reject H<sub>0</sub> because the p-value&gt;&alpha;.</li>
<li>It appears that the distributions of levels of agreement does differ by political party affiliation. Analysis of the row percentage table (`r tbls("EdmPercTable",display="cite")`) suggests that respondents affiliated with the Progressive Conservative party generally more strongly agreed with the statement about unions and unemployment.</li>

`r tbls("EdmPercTable")`

```{r echo=FALSE}
percTable(obs,margin=1,digits=1)
```

<li>Not necessary with a chi-square test.</li>
</ol>

R Appendix.
```{r eval=FALSE, prompt=FALSE}
<<EdmCalc>>
```

----

## AIDS Cases
```{r AIDSCalc, echo=FALSE, results='hide'}
obs <- matrix(c(12855,14946,7019,439,1924,6784,1948,103),nrow=2,byrow=TRUE)
rownames(obs) <- c("Male","Female")
colnames(obs) <- c("White","Black","Hispanic","Other")
( aids.chi <- chisq.test(obs,correct=FALSE) )
```

<ol>
  <li>&alpha;=0.01.</li>
  <li>H<sub>0</sub>: "The distribution of people in the race categories is the same for males and females" versus H<sub>A</sub>: "The distribution of people in the race categories is NOT the same for males and females."</li>
  <li>A chi-square test is required because a categorical response variable with four levels (race/ethnicity) from two groups or populations (sex) was recorded.</li>
  <li>This is an observational study without obvious randomization.</li>
  <li>The test statistic computed below should reasonably follow a chi-square distribution because all cells in the expected table (`r tbls("aids1",display="cite")`) have values greater than five.</li>

`r tbls("aids1")`

```{r AIDSExpTable,echo=FALSE,background="white"}
round(aids.chi$expected,1)
```

  <li>The table of observed frequencies were given as in `r tbls("aids2",display="cite")`.</li>

`r tbls("aids2")`

```{r echo=FALSE,background="white"}
aids.chi$observed
```

  <li>The &chi;<sup>2</sup> test statistic is `r formatC(aids.chi$statistic,format="f",digits=1)` with `r formatC(aids.chi$parameter,format="f",digits=0)` df (`r tbls("aids3",display="cite")`).</li>
  <li>The p-value is `r kPvalue(aids.chi$p.value,include.p=FALSE,latex=FALSE)`. [*R suggests that the p-value is zero, but it cannot be zero and is just much smaller than the computer can show.*]</li>
  <li>The H<sub>0</sub> is rejected because the p-value<&alpha;.</li>
  <li>It appears that the distribution of the individuals into the races/ethnicities differs between the sexes. An analysis of the row percentages table (`r tbls("aids4",display="cite")`) shows that there are many more white males and black females than would be expected.</li>

`r tbls("aids4")`

```{r AIDSResids,echo=FALSE,background="white"}
percTable(obs,margin=1,digits=1)
```

</ol>

R Appendix.
```{r eval=FALSE,prompt=FALSE}
library(NCStats)
distrib(1650.8,distrib="chisq",df=3,lower.tail=FALSE)
```

----

## Forest Composition

```{r ForestCalc, echo=FALSE, results='hide', fig.show='hide', warning=FALSE}
d <- read.csv("https://raw.githubusercontent.com/droglenc/NCData/master/Fire.csv")
d$sttype <- factor(d$sttype,levels=c("c","mc","md","d"))
obs <- xtabs(~sttype+tslf,data=d)
chi1 <- chisq.test(obs,correct=FALSE)
chi1$expected
chi1
percTable(obs,margin=1,digits=1)
```

<ol>
<li>&alpha;=0.05.</li>
<li>H<sub>A</sub>: "The distribution of stands into the times since last fire differs among stand types" and H<sub>0</sub>: "The distribution of stands into the times since last fire DOES NOT differ among stand types".</li>
<li>Chi-square test because (i) the response variable (time since last fire) is categorial (in the way it was recorded) and (ii) two or more groups or populations (stand types) were sampled.</li>
<li>This is an observational study because the stand type was not set or manipulated by the researcher. The stands were not obviously randomly selected.</li>
<li>All cells in the expected frequency table (`r tbls("ForestExpTable",display="cite")`) were NOT greater than 5. The p-value calculation below is suspect.</li>

`r tbls("ForestExpTable")`

```{r echo=FALSE}
chi1$expected
```

<li>The observed frequency table is shown in `r tbls("ForestObsTable",display="cite")`.</li>

`r tbls("ForestObsTable")`

```{r echo=FALSE}
chi1$observed
```

<li>&chi;<sup>2</sup>=`r formatC(chi1$statistic,format="f",digits=4)` with `r chi1$parameter` df (`r tbls("ForestResults",display="cite")`).</li>

`r tbls("ForestResults")`

```{r echo=FALSE}
chi1
```

<li>p-value=`r kPvalue(chi1$p.value,include.p=FALSE,latex=FALSE)` (`r tbls("ForestResults",display="cite")`).</li>
<li>Reject H<sub>0</sub> because the p-value&lt;&alpha;.</li>
<li>It appears that the distribution of stands into the times since last fire differs among at least one pair of the stand types. Analysis of the row percentage table (`r tbls("ForestPercTable",display="cite")`) suggests the time since last fire increases as one moves from primarily deciduous to primarily coniferous stands.</li>

`r tbls("ForestPercTable")`

```{r echo=FALSE}
percTable(obs,margin=1,digits=1)
```

<li>Not necessary with a chi-square test.</li>
</ol>

R Appendix.
```{r eval=FALSE, prompt=FALSE}
<<ForestCalc>>
```

----
