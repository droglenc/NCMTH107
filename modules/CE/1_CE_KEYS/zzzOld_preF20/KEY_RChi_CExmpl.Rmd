---
title: "Answer Key"
subtitle: "R Chi-Square Class Example"
author: Derek H. Ogle
layout: page
css: "/css/modules.css"
output:
  html_document:
    fig_height: 3.5
    fig_width: 3.5
    self_contained: false
---

```{r echo=FALSE, eval=FALSE}
## Renders an appropriate HTML file and moves to CE directory
source("1_CE_Keys/zzz_modHTML_CEKeys.R")
modHTML_CEKeys("KEY_RChi_CExmpl")
```

```{r echo=FALSE, results='hide', message=FALSE, warning=FALSE}
library(NCStats)
source("../../../rhelpers/knitr_setup.R")
```

----

## Recycling in Two Communities II
The full 11-steps for this example are in these [annotations for the chi-square test class example](KEY_ChiSquare_CExmpl). However, the calculations required for Steps 5, 6, 7, 8, and 11 may be computed in R if the raw data are available as they were here.

The data are loaded below. Make note of how the data are stacked as in the two-sample t-test example. Also note that the variable of interest here is `method2` (`method1` provided a more detailed method).
```{r}
dfobj <- read.csv("https://raw.githubusercontent.com/droglenc/NCData/master/PlasticRecycling.csv")
str(dfobj)
headtail(dfobj)
```

The primary R function for this analysis is `chisq.test()`. However, it requires an observed frequency table as its first argument, which must be calculated first with `xtabs()` as you did in the Bivariate EDA - Categorical module (remember that the row variable comes first). The `chisq.test()` also requires `correct=FALSE` so that an unneeded correction factor is not applied.

```{r}
( obs <- xtabs(~city+method2,data=dfobj) )
( chi1 <- chisq.test(obs,correct=FALSE) )
```

From this output one can see

* The observed table needed for Step 6.
* The chi-square test statistic (=`r formatC(chi1$statistic,format="f",digits=1)`) and df (=`r chi1$parameter`) for Step 7.
* The p-value (=`r formatC(chi1$p.value,format="f",digits=11)`) for Step 8.

The expected table for Step 5 can be shown by appending `$expected` to the object saved from `chisq.test()`.

```{r}
chi1$expected
```

And, while it is not needed, you can see the parts that went into the chi-square test statistic calculation with
```{r}
chi1$residuals^2
```

Note that you will complete all 11 steps when you have the raw data, but you should use `chisq.test()` as shown here to perform all of the calculations for you.

&nbsp;

----

## Green Parakeet Crosses II
The full 11-steps for this example are in these [annotations for the goodness-of-fit test class example](KEY_GOFTest_CExmpl). However, the calculations required for Steps 5, 6, 7, 8, and 11 may be computed in R as described below.

The expected values in each cell must first be entered into a vector. These expected values can be the actual expected counts, expected percentages, or values that are in the proper ratio for the expected values. In this example, it was expected that vor every 9 green parakeets there would be three each of blue and yellow parakeets and 1 white parakeet. These ratios are entered into the `exp` vector below.

```{r}
exp <- c(9,3,3,1)
```

The observed values for the sample should also be entered into a vector. For results that are easier to read, the values in this vector can be named according to the groups in the data, as illustrated below. This is also the observed table for Step 6.

```{r}
obs <- c(green=95,blue=27,yellow=22,white=6)
```

The goodness-of-fit test is then "run" with `chisq.test()` using the vector of observed values as the first argument and the expected values in `p=`. In addition, use `rescale=TRUE` so that the expected percentages or ratios will be properly converted to expected values and `correct=FALSE` to not use a minor correction factor.

```{r}
( gof1 <- chisq.test(obs,p=exp,rescale=TRUE,correct=FALSE) )
```

From this output one can see

* The chi-square test statistic (=`r formatC(gof1$statistic,format="f",digits=1)`) and df (=`r gof1$parameter`) for Step 7.
* The p-value (=`r formatC(gof1$p.value,format="f",digits=3)`) for Step 8.

The expected table for Step 5 can be shown by appending `$expected` to the object saved from `chisq.test()`.

```{r}
gof1$expected
```

And, while it is not needed, you can see the parts that went into the chi-square test statistic calculation with
```{r}
gof1$residuals^2
```

Note that you will complete all 11 steps when you have the raw data, but you should use `chisq.test()` as shown here to perform all of the calculations for you.
